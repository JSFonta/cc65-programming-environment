;
; File generated by cc65 v 2.17 - Git 6c320f7d
;
	.fopt		compiler,"cc65 v 2.17 - Git 6c320f7d"
	.setcpu		"65C02"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	off
	.importzp	sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.forceimport	__STARTUP__
	.import		_printf
	.import		_mega65_fast
	.import		_setup_screen
	.import		_kbhit
	.import		_cgetc
	.import		_layout
	.import		_displayText
	.export		_setupSerial
	.export		_write_modem
	.export		_modem_line
	.export		_modem_line_len
	.export		_process_modem_line
	.export		_poll_modem
	.export		_main

.segment	"DATA"

_modem_line_len:
	.byte	$00

.segment	"RODATA"

L0227:
	.byte	$48,$65,$79,$2C,$20,$77,$65,$6C,$63,$6F,$6D,$65,$20,$6F,$6E,$20
	.byte	$74,$68,$69,$73,$20,$6D,$61,$72,$76,$65,$6C,$6F,$75,$73,$20,$73
	.byte	$63,$72,$65,$65,$6E,$20,$21,$00
L020A:
	.byte	$6E,$6F,$62,$6F,$64,$79,$20,$3A,$28,$20,$4D,$61,$6B,$65,$20,$73
	.byte	$6F,$6D,$65,$20,$66,$72,$69,$65,$6E,$64,$73,$20,$3A,$29,$00
L0221:
	.byte	$32,$38,$2F,$30,$38,$20,$31,$30,$3A,$30,$36,$20,$7C,$20,$4A,$65
	.byte	$61,$6E,$2D,$53,$65,$62,$61,$73,$74,$69,$65,$6E,$20,$3A,$00
L0233:
	.byte	$54,$68,$61,$6E,$6B,$73,$20,$6D,$61,$6E,$20,$21,$20,$4E,$69,$63
	.byte	$65,$20,$65,$78,$61,$6D,$70,$6C,$65,$20,$3A,$2D,$29,$00
L022D:
	.byte	$59,$6F,$75,$20,$7C,$20,$32,$38,$2F,$30,$38,$20,$31,$30,$3A,$31
	.byte	$35,$00
L0201:
	.byte	$43,$61,$6C,$6C,$20,$77,$69,$74,$68,$20,$00
L0127:
	.byte	$25,$73,$0A,$00

.segment	"BSS"

_modem_line:
	.res	255,$00

; ---------------------------------------------------------------
; int __near__ setupSerial (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_setupSerial: near

.segment	"CODE"

	lda     #$B2
	sta     $D0E6
	lda     #$01
	sta     $D0E7
	ldx     #$00
	txa
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ write_modem (__near__ const unsigned char *, const unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_write_modem: near

.segment	"CODE"

	jsr     pusha
	jsr     decsp1
	lda     #$00
L02A1:	sta     (sp)
	ldy     #$01
	cmp     (sp),y
	jeq     incsp4
	ldy     #$03
	lda     (sp),y
	sta     ptr1+1
	dey
	lda     (sp),y
	sta     ptr1
	lda     (sp)
	tay
	lda     (ptr1),y
	sta     $D0E0
	lda     (sp)
	ina
	bra     L02A1

.endproc

; ---------------------------------------------------------------
; void __near__ process_modem_line (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_process_modem_line: near

.segment	"CODE"

	lda     #<(L0127)
	ldx     #>(L0127)
	jsr     pushax
	lda     #<(_modem_line)
	ldx     #>(_modem_line)
	jsr     pushax
	ldy     #$04
	jmp     _printf

.endproc

; ---------------------------------------------------------------
; void __near__ poll_modem (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_poll_modem: near

.segment	"CODE"

	lda     $D0E0
	jsr     pusha
	lda     (sp)
	beq     L013B
	cmp     #$0D
	beq     L02A2
	cmp     #$0A
	bne     L02A3
L02A2:	ldy     _modem_line_len
	lda     #$00
	sta     _modem_line,y
	jsr     _process_modem_line
	stz     _modem_line_len
	jmp     incsp1
L02A3:	lda     _modem_line_len
	cmp     #$FE
	bcs     L013B
	inc     _modem_line_len
	clc
	adc     #<(_modem_line)
	sta     ptr1
	lda     #$00
	adc     #>(_modem_line)
	sta     ptr1+1
	lda     (sp)
	sta     (ptr1)
L013B:	jmp     incsp1

.endproc

; ---------------------------------------------------------------
; void __near__ main (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_main: near

.segment	"RODATA"

L0148:
	.byte	$59,$45,$53,$20,$4F,$50,$54,$55,$53,$00
	.byte	$30,$39,$3A,$32,$36,$3A,$33,$30,$00
	.res	1,$00
	.byte	$34,$47,$2B,$00
	.res	6,$00
	.byte	$4C,$6F,$77,$00
	.res	6,$00
L0152:
	.byte	$50,$61,$75,$6C,$00
	.res	13,$00
	.byte	$4A,$73,$00
	.res	15,$00
	.byte	$53,$65,$63,$72,$65,$74,$00
	.res	11,$00
	.byte	$4C,$6F,$72,$65,$6D,$20,$49,$70,$73,$75,$6D,$00
	.res	6,$00
	.byte	$46,$6C,$69,$6E,$64,$65,$72,$73,$00
	.res	9,$00

.segment	"CODE"

	ldy     #$67
	jsr     subysp
	lda     #$00
	jsr     pusha
	jsr     decsp1
	jsr     pusha
	ldy     #$28
	jsr     subysp
	ldy     #$27
L014C:	lda     L0148,y
	sta     (sp),y
	dey
	bpl     L014C
	lda     #$05
	jsr     pusha
	lda     #$00
	jsr     pusha
	ldy     #$5A
	jsr     subysp
	ldy     #$59
L0157:	lda     L0152,y
	sta     (sp),y
	dey
	bpl     L0157
	jsr     _mega65_fast
	jsr     _setup_screen
	stz     $D021
	lda     #$41
	sta     $0000
	lda     #$47
	sta     $D02F
	lda     #$53
	sta     $D02F
	jsr     _setupSerial
	lda     #$01
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
L016F:	ldy     #$EB
L02A9:	lda     (sp),y
	cmp     #$01
	jne     L02C2
	dea
	ldy     #$ED
	bra     L02D2
L0177:	ldy     #$ED
	lda     (sp),y
	clc
	adc     #$82
	pha
	lda     #$00
	adc     #$F4
	tax
	pla
	jsr     pushax
	lda     sp
	ldx     sp+1
	clc
	adc     #$89
	bcc     L0185
	inx
L0185:	ldy     #$EF
	clc
	adc     (sp),y
	bcc     L0186
	inx
L0186:	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1)
	jsr     staspidx
	ldy     #$ED
	lda     (sp),y
	ina
L02D2:	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02D7
	inx
	clc
L02D7:	adc     (sp),y
	bcc     L017D
	inx
L017D:	sta     ptr1
	stx     ptr1+1
	lda     (ptr1)
	bne     L0177
	jmp     L01D9
L0188:	jsr     _cgetc
	ldy     #$85
	sta     (sp),y
	cmp     #$14
	bne     L02AE
	lda     #$00
	ldy     #$ED
	bra     L02D3
L0192:	ldy     #$ED
	lda     (sp),y
	clc
	adc     #$82
	sta     ptr1
	lda     #$00
	adc     #$F4
	sta     ptr1+1
	lda     #$20
	sta     (ptr1)
	ldy     #$ED
	lda     (sp),y
	ina
L02D3:	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02D8
	inx
	clc
L02D8:	adc     (sp),y
	bcc     L0198
	inx
L0198:	sta     ptr1
	stx     ptr1+1
	lda     (ptr1)
	bne     L0192
	ldy     #$86
	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02AC
	inx
L02AC:	sta     ptr1
	stx     ptr1+1
	lda     (sp),y
	tay
	lda     #$00
	sta     (ptr1),y
	ldy     #$85
L02AE:	lda     (sp),y
	cmp     #$2C
	beq     L02AF
	cmp     #$2E
	bne     L02B3
L02AF:	lda     (sp),y
	cmp     #$2C
	bne     L01A9
	ldy     #$5A
	lda     (sp),y
	bne     L02B1
	iny
	lda     (sp),y
	sec
	sbc     #$01
	dey
	sta     (sp),y
	jmp     L01D9
L02B1:	lda     (sp),y
	pha
	dea
	jmp     L02D4
L01A9:	ldy     #$5A
	ldx     #$00
	lda     (sp),y
	sta     ptr1
	stz     ptr1+1
	iny
	lda     (sp),y
	sec
	sbc     #$01
	bcs     L01B5
	dex
L01B5:	cpx     ptr1+1
	bne     L01B3
	cmp     ptr1
	bne     L01B3
	lda     #$00
	dey
	sta     (sp),y
	jmp     L01D9
L01B3:	dey
	lda     (sp),y
	ina
	sta     (sp),y
	jmp     L01D9
L02B3:	lda     (sp),y
	cmp     #$63
	beq     L02B4
	cmp     #$43
	bne     L02B6
L02B4:	lda     #$02
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
	jmp     L01D9
L02B6:	lda     (sp),y
	cmp     #$61
	beq     L02B7
	cmp     #$41
	bne     L02B9
L02B7:	lda     #$04
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
	jmp     L01D9
L02B9:	lda     (sp),y
	cmp     #$2F
	bne     L02BB
	lda     #$03
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
	jmp     L01D9
L02BB:	lda     (sp),y
	cmp     #$03
	bne     L01D2
	lda     #$01
	jsr     _layout
	bra     L01D9
L01D2:	iny
	lda     (sp),y
	cmp     #$0E
	bcs     L01D9
	dey
	lda     (sp),y
	cmp     #$30
	beq     L02BC
	cmp     #$31
	beq     L02BC
	cmp     #$32
	beq     L02BC
	cmp     #$33
	beq     L02BC
	cmp     #$34
	beq     L02BC
	cmp     #$35
	beq     L02BC
	cmp     #$36
	beq     L02BC
	cmp     #$37
	beq     L02BC
	cmp     #$38
	beq     L02BC
	cmp     #$39
	beq     L02BC
	cmp     #$23
	beq     L02BC
	cmp     #$2A
	beq     L02BC
	cmp     #$2B
	bne     L01D9
L02BC:	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L01DE
	inx
L01DE:	sta     ptr1
	stx     ptr1+1
	lda     (sp),y
	pha
	iny
	lda     (sp),y
	tay
	pla
	sta     (ptr1),y
	ldy     #$86
	ldx     #$00
	lda     (sp),y
	ina
	bne     L01E3
	inx
L01E3:	clc
	adc     #$87
	bcc     L01E4
	inx
	clc
L01E4:	adc     sp
	sta     ptr1
	txa
	adc     sp+1
	sta     ptr1+1
	lda     #$00
	sta     (ptr1)
	ldy     #$86
	lda     (sp),y
	pha
	ina
L02D4:	sta     (sp),y
	pla
L01D9:	jsr     _kbhit
	cmp     #$00
	jne     L0188
	ldy     #$ED
L02DB:	sta     (sp),y
	lda     (sp),y
	ldy     #$5B
	cmp     (sp),y
	jcs     L016F
	jsr     decsp6
	ldy     #$F3
	lda     (sp),y
	jsr     pusha0
	lda     #$12
	jsr     tosmula0
	clc
	adc     #$06
	bcc     L01F2
	inx
	clc
L01F2:	adc     sp
	tay
	txa
	adc     sp+1
	tax
	tya
	ldy     #$04
	sta     (sp),y
	iny
	txa
	sta     (sp),y
	ldy     #$F3
	ldx     #$00
	lda     (sp),y
	clc
	adc     #$05
	bcc     L01F5
	inx
L01F5:	jsr     shlax4
	jsr     shlax2
	clc
	adc     #$15
	bcc     L02A7
	inx
	clc
L02A7:	adc     #$03
	bcc     L01F7
	inx
L01F7:	stz     sreg
	stz     sreg+1
	jsr     steax0sp
	ldy     #$F3
	lda     (sp),y
	ldy     #$60
	cmp     (sp),y
	bne     L02BF
	lda     #$07
	bra     L02C0
L02BF:	lda     #$01
L02C0:	jsr     _displayText
	ldy     #$ED
	lda     (sp),y
	ina
	bra     L02DB
L02C2:	lda     (sp),y
	cmp     #$02
	bne     L02C4
	jsr     decsp6
	lda     #<(L0201)
	ldy     #$04
	sta     (sp),y
	iny
	lda     #>(L0201)
	sta     (sp),y
	lda     #$42
	sta     (sp)
	lda     #$01
	tay
	sta     (sp),y
	dea
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	ina
	jsr     _displayText
	jsr     decsp6
	ldy     #$8C
	lda     (sp),y
	beq     L0208
	lda     sp
	ldx     sp+1
	clc
	adc     #$8D
	bcc     L020C
	inx
	bra     L020C
L0208:	lda     #<(L020A)
	ldx     #>(L020A)
L020C:	ldy     #$04
	sta     (sp),y
	iny
	txa
	sta     (sp),y
	lda     #$4C
	sta     (sp)
	lda     #$01
	tay
	sta     (sp),y
	dea
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	ina
	jsr     _displayText
	bra     L0217
L0211:	jsr     _cgetc
	ldy     #$85
	sta     (sp),y
	cmp     #$03
	bne     L0217
	lda     #$01
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
L0217:	jsr     _kbhit
	cmp     #$00
	bne     L0211
	jmp     L016F
L02C4:	lda     (sp),y
	cmp     #$03
	jne     L02D1
	jsr     decsp6
	lda     #<(L0221)
	ldy     #$04
	sta     (sp),y
	iny
	lda     #>(L0221)
	sta     (sp),y
	lda     #$12
	sta     (sp)
	lda     #$02
	ldy     #$01
	sta     (sp),y
	lda     #$00
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	lda     #$02
	jsr     _displayText
	jsr     decsp6
	lda     #<(L0227)
	ldy     #$04
	sta     (sp),y
	iny
	lda     #>(L0227)
	sta     (sp),y
	lda     #$4A
	sta     (sp)
	lda     #$02
	ldy     #$01
	sta     (sp),y
	lda     #$00
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	lda     #$0F
	jsr     _displayText
	jsr     decsp6
	lda     #<(L022D)
	ldy     #$04
	sta     (sp),y
	iny
	lda     #>(L022D)
	sta     (sp),y
	lda     #$43
	sta     (sp)
	lda     #$01
	tay
	sta     (sp),y
	dea
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	lda     #$06
	jsr     _displayText
	jsr     decsp6
	lda     #<(L0233)
	ldy     #$04
	sta     (sp),y
	iny
	lda     #>(L0233)
	sta     (sp),y
	lda     #$82
	sta     (sp)
	lda     #$01
	tay
	sta     (sp),y
	dea
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	lda     #$0F
	jsr     _displayText
	jsr     decsp6
	lda     sp
	ldx     sp+1
	clc
	adc     #$8D
	bcc     L023A
	inx
L023A:	ldy     #$04
	sta     (sp),y
	iny
	txa
	sta     (sp),y
	lda     #$C3
	sta     (sp)
	lda     #$06
	ldy     #$01
	sta     (sp),y
	lda     #$00
	iny
	sta     (sp),y
	iny
	sta     (sp),y
	ina
	jsr     _displayText
	jmp     L0281
L023E:	jsr     _cgetc
	ldy     #$85
	sta     (sp),y
	cmp     #$03
	bne     L02C6
	lda     #$01
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
	jmp     L0281
L02C6:	lda     (sp),y
	cmp     #$65
	beq     L02C7
	cmp     #$45
	bne     L02CB
L02C7:	lda     #$00
	ldy     #$ED
	bra     L02D5
L0250:	ldy     #$ED
	lda     (sp),y
	clc
	adc     #$C3
	sta     ptr1
	lda     #$00
	adc     #$FA
	sta     ptr1+1
	lda     #$20
	sta     (ptr1)
	ldy     #$ED
	lda     (sp),y
	ina
L02D5:	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02D9
	inx
	clc
L02D9:	adc     (sp),y
	bcc     L0256
	inx
L0256:	sta     ptr1
	stx     ptr1+1
	lda     (ptr1)
	bne     L0250
	ldy     #$86
	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02C9
	inx
L02C9:	sta     ptr1
	stx     ptr1+1
	lda     (sp),y
	tay
	lda     #$00
	sta     (ptr1),y
	jmp     L0281
L02CB:	lda     (sp),y
	cmp     #$73
	beq     L02CC
	cmp     #$53
	bne     L0266
L02CC:	lda     #$00
	ldy     #$ED
	bra     L02D6
L026B:	ldy     #$ED
	lda     (sp),y
	clc
	adc     #$C3
	sta     ptr1
	lda     #$00
	adc     #$FA
	sta     ptr1+1
	lda     #$20
	sta     (ptr1)
	ldy     #$ED
	lda     (sp),y
	ina
L02D6:	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02DA
	inx
	clc
L02DA:	adc     (sp),y
	bcc     L0271
	inx
L0271:	sta     ptr1
	stx     ptr1+1
	lda     (ptr1)
	bne     L026B
	ldy     #$86
	sta     (sp),y
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02CE
	inx
L02CE:	sta     ptr1
	stx     ptr1+1
	lda     (sp),y
	tay
	lda     #$00
	sta     (ptr1),y
	bra     L0281
L0266:	iny
	lda     (sp),y
	cmp     #$FF
	bcs     L0281
	lda     sp
	ldx     sp+1
	clc
	adc     #$87
	bcc     L02CF
	inx
L02CF:	sta     ptr1
	stx     ptr1+1
	dey
	lda     (sp),y
	pha
	iny
	lda     (sp),y
	tay
	pla
	sta     (ptr1),y
	ldy     #$86
	ldx     #$00
	lda     (sp),y
	ina
	bne     L028A
	inx
L028A:	clc
	adc     #$87
	bcc     L028B
	inx
	clc
L028B:	adc     sp
	sta     ptr1
	txa
	adc     sp+1
	sta     ptr1+1
	lda     #$00
	sta     (ptr1)
	ldy     #$86
	lda     (sp),y
	ina
	sta     (sp),y
L0281:	jsr     _kbhit
	cmp     #$00
	jne     L023E
	jmp     L016F
L02D1:	lda     (sp),y
	cmp     #$04
	jne     L02A9
	bra     L0297
L0291:	jsr     _cgetc
	ldy     #$85
	sta     (sp),y
	cmp     #$03
	bne     L0297
	lda     #$01
	ldy     #$EB
	sta     (sp),y
	jsr     _layout
L0297:	jsr     _kbhit
	cmp     #$00
	bne     L0291
	jmp     L016F

.endproc

